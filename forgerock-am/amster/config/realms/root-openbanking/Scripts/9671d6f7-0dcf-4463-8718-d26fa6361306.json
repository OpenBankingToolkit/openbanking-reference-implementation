{
  "metadata" : {
    "realm" : "/openbanking",
    "amsterVersion" : "&{version}",
    "entityType" : "Scripts",
    "entityId" : "9671d6f7-0dcf-4463-8718-d26fa6361306",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "9671d6f7-0dcf-4463-8718-d26fa6361306",
    "name" : "openbanking",
    "description" : "OpenBanking claim script is storing the intent id into the id token",
    "script" : "LyoKICogQ29weXJpZ2h0IDIwMTQtMjAxNyBGb3JnZVJvY2sgQVMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQKICoKICogVXNlIG9mIHRoaXMgY29kZSByZXF1aXJlcyBhIGNvbW1lcmNpYWwgc29mdHdhcmUgbGljZW5zZSB3aXRoIEZvcmdlUm9jayBBUy4KICogb3Igd2l0aCBvbmUgb2YgaXRzIGFmZmlsaWF0ZXMuIEFsbCB1c2Ugc2hhbGwgYmUgZXhjbHVzaXZlbHkgc3ViamVjdAogKiB0byBzdWNoIGxpY2Vuc2UgYmV0d2VlbiB0aGUgbGljZW5zZWUgYW5kIEZvcmdlUm9jayBBUy4KICovCmltcG9ydCBjb20uaXBsYW5ldC5zc28uU1NPRXhjZXB0aW9uCmltcG9ydCBjb20uc3VuLmlkZW50aXR5LmlkbS5JZFJlcG9FeGNlcHRpb24KaW1wb3J0IG9yZy5mb3JnZXJvY2sub2F1dGgyLmNvcmUuZXhjZXB0aW9ucy5JbnZhbGlkUmVxdWVzdEV4Y2VwdGlvbgppbXBvcnQgb3JnLmZvcmdlcm9jay5vYXV0aDIuY29yZS5Vc2VySW5mb0NsYWltcwppbXBvcnQgb3JnLmZvcmdlcm9jay5vcGVuaWRjb25uZWN0LkNsYWltCgovKgoqIERlZmluZWQgdmFyaWFibGVzOgoqIGxvZ2dlciAtIGFsd2F5cyBwcmVzZW50cywgdGhlICJPQXV0aDJQcm92aWRlciIgZGVidWcgbG9nZ2VyIGluc3RhbmNlCiogY2xhaW1zIC0gYWx3YXlzIHByZXNlbnQsIGRlZmF1bHQgc2VydmVyIHByb3ZpZGVkIGNsYWltcyAtIE1hcDxTdHJpbmcsIE9iamVjdD4KKiBjbGFpbU9iamVjdHMgLSBhbHdheXMgcHJlc2VudCwgZGVmYXVsdCBzZXJ2ZXIgcHJvdmlkZWQgY2xhaW1zIC0gTGlzdDxDbGFpbT4KKiBzZXNzaW9uIC0gcHJlc2VudCBpZiB0aGUgcmVxdWVzdCBjb250YWlucyB0aGUgc2Vzc2lvbiBjb29raWUsIHRoZSB1c2VyJ3Mgc2Vzc2lvbiBvYmplY3QKKiBpZGVudGl0eSAtIGFsd2F5cyBwcmVzZW50LCB0aGUgaWRlbnRpdHkgb2YgdGhlIHJlc291cmNlIG93bmVyCiogc2NvcGVzIC0gYWx3YXlzIHByZXNlbnQsIHRoZSByZXF1ZXN0ZWQgc2NvcGVzCiogcmVxdWVzdGVkQ2xhaW1zIC0gTWFwPFN0cmluZywgU2V0PFN0cmluZz4+CiogICAgICAgICAgICAgICAgICBhbHdheXMgcHJlc2VudCwgbm90IGVtcHR5IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIGEgY2xhaW1zIHBhcmFtZXRlciBhbmQgc2VydmVyIGhhcyBlbmFibGVkCiogICAgICAgICAgICAgICAgICBjbGFpbXNfcGFyYW1ldGVyX3N1cHBvcnRlZCwgbWFwIG9mIHJlcXVlc3RlZCBjbGFpbXMgdG8gcG9zc2libGUgdmFsdWVzLCBvdGhlcndpc2UgZW1wdHksCiogICAgICAgICAgICAgICAgICByZXF1ZXN0ZWQgY2xhaW1zIHdpdGggbm8gcmVxdWVzdGVkIHZhbHVlcyB3aWxsIGhhdmUgYSBrZXkgYnV0IG5vIHZhbHVlIGluIHRoZSBtYXAuIEEga2V5IHdpdGgKKiAgICAgICAgICAgICAgICAgIGEgc2luZ2xlIHZhbHVlIGluIGl0cyBTZXQgaW5kaWNhdGVzIHRoaXMgaXMgdGhlIG9ubHkgdmFsdWUgdGhhdCBzaG91bGQgYmUgcmV0dXJuZWQuCiogcmVxdWVzdGVkVHlwZWRDbGFpbXMgLSBMaXN0PENsYWltPgoqICAgICAgICAgICAgICAgICAgICAgICBhbHdheXMgcHJlc2VudCwgbm90IGVtcHR5IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIGEgY2xhaW1zIHBhcmFtZXRlciBhbmQgc2VydmVyIGhhcyBlbmFibGVkCiogICAgICAgICAgICAgICAgICAgICAgIGNsYWltc19wYXJhbWF0ZXJfc3VwcG9ydGVkLCBsaXN0IG9mIHJlcXVlc3RlZCBjbGFpbXMgd2l0aCBjbGFpbSBuYW1lLCByZXF1ZXN0ZWQgcG9zc2libGUgdmFsdWVzCiogICAgICAgICAgICAgICAgICAgICAgIGFuZCBpZiBjbGFpbSBpcyBlc3NlbnRpYWwsIG90aGVyd2lzZSBlbXB0eSwKKiAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGVkIGNsYWltcyB3aXRoIG5vIHJlcXVlc3RlZCB2YWx1ZXMgd2lsbCBoYXZlIGEgY2xhaW0gd2l0aCBubyB2YWx1ZXMuIEEgY2xhaW1zIHdpdGgKKiAgICAgICAgICAgICAgICAgICAgICAgYSBzaW5nbGUgdmFsdWUgaW5kaWNhdGVzIHRoaXMgaXMgdGhlIG9ubHkgdmFsdWUgdGhhdCBzaG91bGQgYmUgcmV0dXJuZWQuCiogY2xhaW1zTG9jYWxlcyAtIHRoZSB2YWx1ZXMgZnJvbSB0aGUgJ2NsYWltc19sb2NhbGVzJyBwYXJhbWV0ZXIgLSBMaXN0PFN0cmluZz4KKiBSZXF1aXJlZCB0byByZXR1cm4gYSBNYXAgb2YgY2xhaW1zIHRvIGJlIGFkZGVkIHRvIHRoZSBpZF90b2tlbiBjbGFpbXMKKgoqIEV4cGVjdGVkIHJldHVybiB2YWx1ZSBzdHJ1Y3R1cmU6CiogVXNlckluZm9DbGFpbXMgewoqICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gdmFsdWVzOyAvLyBUaGUgdmFsdWVzIG9mIHRoZSBjbGFpbXMgZm9yIHRoZSB1c2VyIGluZm9ybWF0aW9uCiogICAgTWFwPFN0cmluZywgTGlzdDxTdHJpbmc+PiBjb21wb3NpdGVTY29wZXM7IC8vIE1hcHBpbmcgb2Ygc2NvcGUgbmFtZSB0byBhIGxpc3Qgb2YgY2xhaW0gbmFtZXMuCiogfQoqLwoKLy8gdXNlciBzZXNzaW9uIG5vdCBndWFyYW50ZWVkIHRvIGJlIHByZXNlbnQKYm9vbGVhbiBzZXNzaW9uUHJlc2VudCA9IHNlc3Npb24gIT0gbnVsbAoKLyoKICogUHVsbHMgZmlyc3QgdmFsdWUgZnJvbSB1c2VycyBwcm9maWxlIGF0dHJpYnV0ZQogKgogKiBAcGFyYW0gY2xhaW0gVGhlIGNsYWltIG9iamVjdC4KICogQHBhcmFtIGF0dHIgVGhlIHByb2ZpbGUgYXR0cmlidXRlIG5hbWUuCiAqLwpkZWYgZnJvbVNldCA9IHsgY2xhaW0sIGF0dHIgLT4KICAgIGlmIChhdHRyICE9IG51bGwgJiYgYXR0ci5zaXplKCkgPT0gMSl7CiAgICAgICAgYXR0ci5pdGVyYXRvcigpLm5leHQoKQogICAgfSBlbHNlIGlmIChhdHRyICE9IG51bGwgJiYgYXR0ci5zaXplKCkgPiAxKXsKICAgICAgICBhdHRyCiAgICB9IGVsc2UgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk9wZW5BTVNjb3BlVmFsaWRhdG9yLmdldFVzZXJJbmZvKCk6IEdvdCBhbiBlbXB0eSByZXN1bHQgZm9yIGNsYWltPSRjbGFpbSIpOwogICAgfQp9CgovLyAtLS12dnZ2dnZ2dnZ2LS0tIEVYQU1QTEUgQ0xBSU0gQVRUUklCVVRFIFJFU09MVkVSIEZVTkNUSU9OUyAtLS12dnZ2dnZ2dnZ2LS0tCi8qCiAqIENsYWltIHJlc29sdmVyIHdoaWNoIHJlc29sdmVzIHRoZSB2YWx1ZSBvZiB0aGUgY2xhaW0gZnJvbSBpdHMgcmVxdWVzdGVkIHZhbHVlcy4KICoKICogVGhpcyByZXNvbHZlciB3aWxsIHJldHVybiBhIHZhbHVlIGlmIHRoZSBjbGFpbSBoYXMgb25lIHJlcXVlc3RlZCB2YWx1ZXMsIG90aGVyd2lzZSBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KZGVmYXVsdENsYWltUmVzb2x2ZXIgPSB7IGNsYWltIC0+CiAgICBpZiAoY2xhaW0uZ2V0VmFsdWVzKCkuc2l6ZSgpID09IDEpIHsKICAgICAgICBbKGNsYWltLmdldE5hbWUoKSk6IGNsYWltLmdldFZhbHVlcygpLml0ZXJhdG9yKCkubmV4dCgpXQogICAgfSBlbHNlIHsKICAgICAgICBbOl0KICAgIH0KfQoKLyoKICogQ2xhaW0gcmVzb2x2ZXIgd2hpY2ggcmVzb2x2ZXMgdGhlIHZhbHVlIG9mIHRoZSBjbGFpbSBieSBsb29raW5nIHVwIHRoZSB1c2VyJ3MgcHJvZmlsZS4KICoKICogVGhpcyByZXNvbHZlciB3aWxsIHJldHVybiBhIHZhbHVlIGZvciB0aGUgY2xhaW0gaWY6CiAqICMgdGhlIHVzZXIncyBwcm9maWxlIGF0dHJpYnV0ZSBpcyBub3QgbnVsbAogKiAjIEFORCB0aGUgY2xhaW0gY29udGFpbnMgbm8gcmVxdWVzdGVkIHZhbHVlcwogKiAjIE9SIHRoZSBjbGFpbSBjb250YWlucyByZXF1ZXN0ZWQgdmFsdWVzIGFuZCB0aGUgdmFsdWUgZnJvbSB0aGUgdXNlcidzIHByb2ZpbGUgaXMgaW4gdGhlIGxpc3Qgb2YgdmFsdWVzCiAqCiAqIElmIG5vIG1hdGNoIGlzIGZvdW5kIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24uCiAqLwp1c2VyUHJvZmlsZUNsYWltUmVzb2x2ZXIgPSB7IGF0dHJpYnV0ZSwgY2xhaW0sIGlkZW50aXR5IC0+CiAgICB1c2VyUHJvZmlsZVZhbHVlID0gZnJvbVNldChjbGFpbS5nZXROYW1lKCksIGlkZW50aXR5LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKQogICAgaWYgKHVzZXJQcm9maWxlVmFsdWUgIT0gbnVsbCAmJiAoY2xhaW0uZ2V0VmFsdWVzKCkgPT0gbnVsbCB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5pc0VtcHR5KCkgfHwgY2xhaW0uZ2V0VmFsdWVzKCkuY29udGFpbnModXNlclByb2ZpbGVWYWx1ZSkpKSB7CiAgICAgIAlsb2dnZXIubWVzc2FnZSgidXNlclByb2ZpbGVDbGFpbVJlc29sdmVyOiB7fSA6IHt9IiwgY2xhaW0uZ2V0TmFtZSgpLCB1c2VyUHJvZmlsZVZhbHVlKTsKCiAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpKTogdXNlclByb2ZpbGVWYWx1ZV0KICAgIH0KICAgIFs6XQp9CgovKgogKiBJbnRlbnQgSUQgY2xhaW0gcmVzb2x2ZXIKICovCkludGVudElkUmVzb2x2ZXIgPSB7IGF0dHJpYnV0ZSwgY2xhaW0sIGlkZW50aXR5IC0+CiAgaWYgKGNsYWltLmdldFZhbHVlcygpICE9IG51bGwgJiYgY2xhaW0uZ2V0VmFsdWVzKCkuc2l6ZSgpID4gMCkgewoJbG9nZ2VyLm1lc3NhZ2UoIkludGVudElkUmVzb2x2ZXI6Ok1lc3NhZ2U6IHt9IDoge30iLCBjbGFpbS5nZXROYW1lKCksIGNsYWltLmdldFZhbHVlcygpLmdldCgwKSkKCXJldHVybiBbKGNsYWltLmdldE5hbWUoKSk6IGNsYWltLmdldFZhbHVlcygpLmdldCgwKSwgInN1YiI6IGNsYWltLmdldFZhbHVlcygpLmdldCgwKV0KICB9IGVsc2UgewogICAgbG9nZ2VyLm1lc3NhZ2UoIkludGVudElkUmVzb2x2ZXI6OiBObyBpbnRlbnQgaWQuIikKICAgIHJldHVybiBbXQogIH0KfQoKLyoKICogSW50ZW50IElEIGNsYWltIHJlc29sdmVyCiAqLwpFbXB0eUNsYWltUmVzb2x2ZXIgPSB7IGF0dHJpYnV0ZSwgY2xhaW0sIGlkZW50aXR5IC0+CiAgICByZXR1cm4gWzpdCn0KCi8qCiAqIEdpdmVuIGEgc3RyaW5nICJlbnxFbmdsaXNoLGpwfEphcGVuZXNlLGZyX0NBfEZyZW5jaCBDYW5hZGlhbiIgd2lsbCByZXR1cm4gbWFwIG9mIGxvY2FsZSAtPiB2YWx1ZS4KICovCnBhcnNlTG9jYWxlQXdhcmVTdHJpbmcgPSB7IHMgLT4KICAgIHJldHVybiByZXN1bHQgPSBzLnNwbGl0KCIsIikuY29sbGVjdEVudHJpZXMgeyBlbnRyeSAtPgogICAgICAgIHNwbGl0ID0gZW50cnkuc3BsaXQoIlxcfCIpCiAgICAgICAgWyhzcGxpdFswXSk6IHZhbHVlID0gc3BsaXRbMV1dCiAgICB9Cn0KLy8gLS0tXl5eXl5eXl5eXi0tLSBFWEFNUExFIENMQUlNIEFUVFJJQlVURSBSRVNPTFZFUiBGVU5DVElPTlMgLS0tXl5eXl5eXl5eXi0tLQoKLy8gLS0tLS0tLS0tLS0tLS0gVVBEQVRFIFRISVMgVE8gQ0hBTkdFIENMQUlNIFRPIEFUVFJJQlVURSBNQVBQSU5HIEZVTkNUSU9OUyAtLS0tLS0tLS0tLS0tLS0KLyoKICogTGlzdCBvZiBjbGFpbSByZXNvbHZlciBtYXBwaW5ncy4KICovCi8vIFsge2NsYWltfToge2F0dHJpYnV0ZSByZXRyaWV2ZXJ9LCAuLi4gXQpjbGFpbUF0dHJpYnV0ZXMgPSBbCiAgICAgICAgIm9wZW5iYW5raW5nX2ludGVudF9pZCI6IEludGVudElkUmVzb2x2ZXIuY3VycnkoIm9wZW5iYW5raW5nX2ludGVudF9pZCIpCl0KCgovLyAtLS0tLS0tLS0tLS0tLSBVUERBVEUgVEhJUyBUTyBDSEFOR0UgU0NPUEUgVE8gQ0xBSU0gTUFQUElOR1MgLS0tLS0tLS0tLS0tLS0KLyoKICogTWFwIG9mIHNjb3BlcyB0byBjbGFpbSBvYmplY3RzLgogKi8KLy8ge3Njb3BlfTogWyB7Y2xhaW19LCAuLi4gXQpzY29wZUNsYWltc01hcCA9IFsKICAgICAgICAiYWNjb3VudCI6IFsgImFjY291bnQiIF0KXQoKCi8vIC0tLS0tLS0tLS0tLS0tLS0gVVBEQVRFIEJFTE9XIEZPUiBBRFZBTkNFRCBVU0FHRVMgLS0tLS0tLS0tLS0tLS0tLS0tLQppZiAobG9nZ2VyLm1lc3NhZ2VFbmFibGVkKCkpIHsKICAgIHNjb3Blcy5maW5kQWxsIHsgcyAtPiAhKCJvcGVuaWQiLmVxdWFscyhzKSB8fCBzY29wZUNsYWltc01hcC5jb250YWluc0tleShzKSkgfS5lYWNoIHsgcyAtPgogICAgICAgIGxvZ2dlci5tZXNzYWdlKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOjpNZXNzYWdlOiBzY29wZSBub3QgYm91bmQgdG8gY2xhaW1zOiAkcyIpCiAgICB9Cn0KCi8qCiAqIENvbXB1dGVzIHRoZSBjbGFpbXMgcmV0dXJuIGtleSBhbmQgdmFsdWUuIFRoZSBrZXkgbWF5IGJlIGEgZGlmZmVyZW50IHZhbHVlIGlmIHRoZSBjbGFpbSB2YWx1ZSBpcyBub3QgaW4KICogdGhlIHJlcXVlc3RlZCBsYW5ndWFnZS4KICovCmRlZiBjb21wdXRlQ2xhaW0gPSB7IGNsYWltIC0+CiAgICB0cnkgewogICAgICAgIGNsYWltUmVzb2x2ZXIgPSBjbGFpbUF0dHJpYnV0ZXMuZ2V0KGNsYWltLmdldE5hbWUoKSwgeyBjbGFpbU9iaiwgaWRlbnRpdHkgLT4gZGVmYXVsdENsYWltUmVzb2x2ZXIoY2xhaW0pfSkKICAgICAgICBjbGFpbVJlc29sdmVyKGNsYWltLCBpZGVudGl0eSkKICAgIH0gY2F0Y2ggKElkUmVwb0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOiBVbmFibGUgdG8gcmV0cmlldmUgYXR0cmlidXRlPSRhdHRyaWJ1dGUiLCBlKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChTU09FeGNlcHRpb24gZSkgewogICAgICAgIGlmIChsb2dnZXIud2FybmluZ0VuYWJsZWQoKSkgewogICAgICAgICAgICBsb2dnZXIud2FybmluZygiT3BlbkFNU2NvcGVWYWxpZGF0b3IuZ2V0VXNlckluZm8oKTogVW5hYmxlIHRvIHJldHJpZXZlIGF0dHJpYnV0ZT0kYXR0cmlidXRlIiwgZSk7CiAgICAgICAgfQogICAgfQp9CgovKgogKiBDb252ZXJ0cyByZXF1ZXN0ZWQgc2NvcGVzIGludG8gY2xhaW0gb2JqZWN0cyBiYXNlZCBvbiB0aGUgc2NvcGUgbWFwcGluZ3MgaW4gc2NvcGVDbGFpbXNNYXAuCiAqLwpkZWYgY29udmVydFNjb3BlVG9DbGFpbXMgPSB7CiAgICBzY29wZXMuZmluZEFsbCB7IHNjb3BlIC0+ICJvcGVuaWQiICE9IHNjb3BlICYmIHNjb3BlQ2xhaW1zTWFwLmNvbnRhaW5zS2V5KHNjb3BlKSB9LmNvbGxlY3RNYW55IHsgc2NvcGUgLT4KICAgICAgICBzY29wZUNsYWltc01hcC5nZXQoc2NvcGUpLmNvbGxlY3QgeyBjbGFpbSAtPgogICAgICAgICAgICBuZXcgQ2xhaW0oY2xhaW0pCiAgICAgICAgfQogICAgfQp9CgovLyBDcmVhdGVzIGEgZnVsbCBsaXN0IG9mIGNsYWltcyB0byByZXNvbHZlIGZyb20gcmVxdWVzdGVkIHNjb3BlcywgY2xhaW1zIHByb3ZpZGVkIGJ5IEFTIGFuZCByZXF1ZXN0ZWQgY2xhaW1zCmRlZiBjbGFpbXNUb1Jlc29sdmUgPSBjb252ZXJ0U2NvcGVUb0NsYWltcygpICsgY2xhaW1PYmplY3RzICsgcmVxdWVzdGVkVHlwZWRDbGFpbXMKCi8vIENvbXB1dGVzIHRoZSBjbGFpbSByZXR1cm4ga2V5IGFuZCB2YWx1ZXMgZm9yIGFsbCByZXF1ZXN0ZWQgY2xhaW1zCmNvbXB1dGVkQ2xhaW1zID0gY2xhaW1zVG9SZXNvbHZlLmNvbGxlY3RFbnRyaWVzKCkgeyBjbGFpbSAtPgogICAgbG9nZ2VyLmVycm9yKCJjbGFpbToge30iLCBjbGFpbSk7CiAgICByZXN1bHQgPSBjb21wdXRlQ2xhaW0oY2xhaW0pOwogICAgbG9nZ2VyLmVycm9yKCJyZXN1bHQ6IHt9IiwgcmVzdWx0KTsKICByZXR1cm4gcmVzdWx0OwoKfQoKLy8gQ29tcHV0ZXMgY29tcG9zaXRlIHNjb3BlcwpkZWYgY29tcG9zaXRlU2NvcGVzID0gc2NvcGVDbGFpbXNNYXAuZmluZEFsbCB7IHNjb3BlIC0+CiAgICBzY29wZXMuY29udGFpbnMoc2NvcGUua2V5KQp9CgpyZXR1cm4gbmV3IFVzZXJJbmZvQ2xhaW1zKChNYXApY29tcHV0ZWRDbGFpbXMsIChNYXApY29tcG9zaXRlU2NvcGVzKQ==",
    "default" : false,
    "language" : "GROOVY",
    "context" : "OIDC_CLAIMS",
    "createdBy" : "null",
    "creationDate" : 0,
    "lastModifiedBy" : "null",
    "lastModifiedDate" : 0
  }
}