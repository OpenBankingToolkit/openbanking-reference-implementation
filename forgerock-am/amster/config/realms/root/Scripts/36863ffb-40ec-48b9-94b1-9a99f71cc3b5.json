{
  "metadata" : {
    "realm" : "/",
    "amsterVersion" : "&{version}",
    "entityType" : "Scripts",
    "entityId" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "name" : "OIDC Claims Script",
    "description" : "Default global script for OIDC claims",
    "script" : "LyoKICogQ29weXJpZ2h0IDIwMTQtMjAxNyBGb3JnZVJvY2sgQVMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQKICoKICogVXNlIG9mIHRoaXMgY29kZSByZXF1aXJlcyBhIGNvbW1lcmNpYWwgc29mdHdhcmUgbGljZW5zZSB3aXRoIEZvcmdlUm9jayBBUy4KICogb3Igd2l0aCBvbmUgb2YgaXRzIGFmZmlsaWF0ZXMuIEFsbCB1c2Ugc2hhbGwgYmUgZXhjbHVzaXZlbHkgc3ViamVjdAogKiB0byBzdWNoIGxpY2Vuc2UgYmV0d2VlbiB0aGUgbGljZW5zZWUgYW5kIEZvcmdlUm9jayBBUy4KICovCmltcG9ydCBjb20uaXBsYW5ldC5zc28uU1NPRXhjZXB0aW9uCmltcG9ydCBjb20uc3VuLmlkZW50aXR5LmlkbS5JZFJlcG9FeGNlcHRpb24KaW1wb3J0IG9yZy5mb3JnZXJvY2sub2F1dGgyLmNvcmUuZXhjZXB0aW9ucy5JbnZhbGlkUmVxdWVzdEV4Y2VwdGlvbgppbXBvcnQgb3JnLmZvcmdlcm9jay5vYXV0aDIuY29yZS5Vc2VySW5mb0NsYWltcwppbXBvcnQgb3JnLmZvcmdlcm9jay5vcGVuaWRjb25uZWN0LkNsYWltCgovKgoqIERlZmluZWQgdmFyaWFibGVzOgoqIGxvZ2dlciAtIGFsd2F5cyBwcmVzZW50cywgdGhlICJPQXV0aDJQcm92aWRlciIgZGVidWcgbG9nZ2VyIGluc3RhbmNlCiogY2xhaW1zIC0gYWx3YXlzIHByZXNlbnQsIGRlZmF1bHQgc2VydmVyIHByb3ZpZGVkIGNsYWltcyAtIE1hcDxTdHJpbmcsIE9iamVjdD4KKiBjbGFpbU9iamVjdHMgLSBhbHdheXMgcHJlc2VudCwgZGVmYXVsdCBzZXJ2ZXIgcHJvdmlkZWQgY2xhaW1zIC0gTGlzdDxDbGFpbT4KKiBzZXNzaW9uIC0gcHJlc2VudCBpZiB0aGUgcmVxdWVzdCBjb250YWlucyB0aGUgc2Vzc2lvbiBjb29raWUsIHRoZSB1c2VyJ3Mgc2Vzc2lvbiBvYmplY3QKKiBpZGVudGl0eSAtIGFsd2F5cyBwcmVzZW50LCB0aGUgaWRlbnRpdHkgb2YgdGhlIHJlc291cmNlIG93bmVyCiogc2NvcGVzIC0gYWx3YXlzIHByZXNlbnQsIHRoZSByZXF1ZXN0ZWQgc2NvcGVzCiogcmVxdWVzdGVkQ2xhaW1zIC0gTWFwPFN0cmluZywgU2V0PFN0cmluZz4+CiogICAgICAgICAgICAgICAgICBhbHdheXMgcHJlc2VudCwgbm90IGVtcHR5IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIGEgY2xhaW1zIHBhcmFtZXRlciBhbmQgc2VydmVyIGhhcyBlbmFibGVkCiogICAgICAgICAgICAgICAgICBjbGFpbXNfcGFyYW1ldGVyX3N1cHBvcnRlZCwgbWFwIG9mIHJlcXVlc3RlZCBjbGFpbXMgdG8gcG9zc2libGUgdmFsdWVzLCBvdGhlcndpc2UgZW1wdHksCiogICAgICAgICAgICAgICAgICByZXF1ZXN0ZWQgY2xhaW1zIHdpdGggbm8gcmVxdWVzdGVkIHZhbHVlcyB3aWxsIGhhdmUgYSBrZXkgYnV0IG5vIHZhbHVlIGluIHRoZSBtYXAuIEEga2V5IHdpdGgKKiAgICAgICAgICAgICAgICAgIGEgc2luZ2xlIHZhbHVlIGluIGl0cyBTZXQgaW5kaWNhdGVzIHRoaXMgaXMgdGhlIG9ubHkgdmFsdWUgdGhhdCBzaG91bGQgYmUgcmV0dXJuZWQuCiogcmVxdWVzdGVkVHlwZWRDbGFpbXMgLSBMaXN0PENsYWltPgoqICAgICAgICAgICAgICAgICAgICAgICBhbHdheXMgcHJlc2VudCwgbm90IGVtcHR5IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIGEgY2xhaW1zIHBhcmFtZXRlciBhbmQgc2VydmVyIGhhcyBlbmFibGVkCiogICAgICAgICAgICAgICAgICAgICAgIGNsYWltc19wYXJhbWF0ZXJfc3VwcG9ydGVkLCBsaXN0IG9mIHJlcXVlc3RlZCBjbGFpbXMgd2l0aCBjbGFpbSBuYW1lLCByZXF1ZXN0ZWQgcG9zc2libGUgdmFsdWVzCiogICAgICAgICAgICAgICAgICAgICAgIGFuZCBpZiBjbGFpbSBpcyBlc3NlbnRpYWwsIG90aGVyd2lzZSBlbXB0eSwKKiAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGVkIGNsYWltcyB3aXRoIG5vIHJlcXVlc3RlZCB2YWx1ZXMgd2lsbCBoYXZlIGEgY2xhaW0gd2l0aCBubyB2YWx1ZXMuIEEgY2xhaW1zIHdpdGgKKiAgICAgICAgICAgICAgICAgICAgICAgYSBzaW5nbGUgdmFsdWUgaW5kaWNhdGVzIHRoaXMgaXMgdGhlIG9ubHkgdmFsdWUgdGhhdCBzaG91bGQgYmUgcmV0dXJuZWQuCiogY2xhaW1zTG9jYWxlcyAtIHRoZSB2YWx1ZXMgZnJvbSB0aGUgJ2NsYWltc19sb2NhbGVzJyBwYXJhbWV0ZXIgLSBMaXN0PFN0cmluZz4KKiBSZXF1aXJlZCB0byByZXR1cm4gYSBNYXAgb2YgY2xhaW1zIHRvIGJlIGFkZGVkIHRvIHRoZSBpZF90b2tlbiBjbGFpbXMKKgoqIEV4cGVjdGVkIHJldHVybiB2YWx1ZSBzdHJ1Y3R1cmU6CiogVXNlckluZm9DbGFpbXMgewoqICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gdmFsdWVzOyAvLyBUaGUgdmFsdWVzIG9mIHRoZSBjbGFpbXMgZm9yIHRoZSB1c2VyIGluZm9ybWF0aW9uCiogICAgTWFwPFN0cmluZywgTGlzdDxTdHJpbmc+PiBjb21wb3NpdGVTY29wZXM7IC8vIE1hcHBpbmcgb2Ygc2NvcGUgbmFtZSB0byBhIGxpc3Qgb2YgY2xhaW0gbmFtZXMuCiogfQoqLwoKLy8gdXNlciBzZXNzaW9uIG5vdCBndWFyYW50ZWVkIHRvIGJlIHByZXNlbnQKYm9vbGVhbiBzZXNzaW9uUHJlc2VudCA9IHNlc3Npb24gIT0gbnVsbAoKLyoKICogUHVsbHMgZmlyc3QgdmFsdWUgZnJvbSB1c2VycyBwcm9maWxlIGF0dHJpYnV0ZQogKgogKiBAcGFyYW0gY2xhaW0gVGhlIGNsYWltIG9iamVjdC4KICogQHBhcmFtIGF0dHIgVGhlIHByb2ZpbGUgYXR0cmlidXRlIG5hbWUuCiAqLwpkZWYgZnJvbVNldCA9IHsgY2xhaW0sIGF0dHIgLT4KICAgIGlmIChhdHRyICE9IG51bGwgJiYgYXR0ci5zaXplKCkgPT0gMSl7CiAgICAgICAgYXR0ci5pdGVyYXRvcigpLm5leHQoKQogICAgfSBlbHNlIGlmIChhdHRyICE9IG51bGwgJiYgYXR0ci5zaXplKCkgPiAxKXsKICAgICAgICBhdHRyCiAgICB9IGVsc2UgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk9wZW5BTVNjb3BlVmFsaWRhdG9yLmdldFVzZXJJbmZvKCk6IEdvdCBhbiBlbXB0eSByZXN1bHQgZm9yIGNsYWltPSRjbGFpbSIpOwogICAgfQp9CgovLyAtLS12dnZ2dnZ2dnZ2LS0tIEVYQU1QTEUgQ0xBSU0gQVRUUklCVVRFIFJFU09MVkVSIEZVTkNUSU9OUyAtLS12dnZ2dnZ2dnZ2LS0tCi8qCiAqIENsYWltIHJlc29sdmVyIHdoaWNoIHJlc29sdmVzIHRoZSB2YWx1ZSBvZiB0aGUgY2xhaW0gZnJvbSBpdHMgcmVxdWVzdGVkIHZhbHVlcy4KICoKICogVGhpcyByZXNvbHZlciB3aWxsIHJldHVybiBhIHZhbHVlIGlmIHRoZSBjbGFpbSBoYXMgb25lIHJlcXVlc3RlZCB2YWx1ZXMsIG90aGVyd2lzZSBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KZGVmYXVsdENsYWltUmVzb2x2ZXIgPSB7IGNsYWltIC0+CiAgICBpZiAoY2xhaW0uZ2V0VmFsdWVzKCkuc2l6ZSgpID09IDEpIHsKICAgICAgICBbKGNsYWltLmdldE5hbWUoKSk6IGNsYWltLmdldFZhbHVlcygpLml0ZXJhdG9yKCkubmV4dCgpXQogICAgfSBlbHNlIHsKICAgICAgICBbOl0KICAgIH0KfQoKLyoKICogQ2xhaW0gcmVzb2x2ZXIgd2hpY2ggcmVzb2x2ZXMgdGhlIHZhbHVlIG9mIHRoZSBjbGFpbSBieSBsb29raW5nIHVwIHRoZSB1c2VyJ3MgcHJvZmlsZS4KICoKICogVGhpcyByZXNvbHZlciB3aWxsIHJldHVybiBhIHZhbHVlIGZvciB0aGUgY2xhaW0gaWY6CiAqICMgdGhlIHVzZXIncyBwcm9maWxlIGF0dHJpYnV0ZSBpcyBub3QgbnVsbAogKiAjIEFORCB0aGUgY2xhaW0gY29udGFpbnMgbm8gcmVxdWVzdGVkIHZhbHVlcwogKiAjIE9SIHRoZSBjbGFpbSBjb250YWlucyByZXF1ZXN0ZWQgdmFsdWVzIGFuZCB0aGUgdmFsdWUgZnJvbSB0aGUgdXNlcidzIHByb2ZpbGUgaXMgaW4gdGhlIGxpc3Qgb2YgdmFsdWVzCiAqCiAqIElmIG5vIG1hdGNoIGlzIGZvdW5kIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24uCiAqLwp1c2VyUHJvZmlsZUNsYWltUmVzb2x2ZXIgPSB7IGF0dHJpYnV0ZSwgY2xhaW0sIGlkZW50aXR5IC0+CiAgICB1c2VyUHJvZmlsZVZhbHVlID0gZnJvbVNldChjbGFpbS5nZXROYW1lKCksIGlkZW50aXR5LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKQogICAgaWYgKHVzZXJQcm9maWxlVmFsdWUgIT0gbnVsbCAmJiAoY2xhaW0uZ2V0VmFsdWVzKCkgPT0gbnVsbCB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5pc0VtcHR5KCkgfHwgY2xhaW0uZ2V0VmFsdWVzKCkuY29udGFpbnModXNlclByb2ZpbGVWYWx1ZSkpKSB7CiAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpKTogdXNlclByb2ZpbGVWYWx1ZV0KICAgIH0KICAgIFs6XQp9CgovKgogKiBDbGFpbSByZXNvbHZlciB3aGljaCByZXNvbHZlcyB0aGUgdmFsdWUgb2YgdGhlIGNsYWltIGJ5IGxvb2tpbmcgdXAgdGhlIHVzZXIncyBwcm9maWxlLgogKgogKiBUaGlzIHJlc29sdmVyIHdpbGwgcmV0dXJuIGEgdmFsdWUgZm9yIHRoZSBjbGFpbSBpZjoKICogIyB0aGUgdXNlcidzIHByb2ZpbGUgYXR0cmlidXRlIGlzIG5vdCBudWxsCiAqICMgQU5EIHRoZSBjbGFpbSBjb250YWlucyBubyByZXF1ZXN0ZWQgdmFsdWVzCiAqICMgT1IgdGhlIGNsYWltIGNvbnRhaW5zIHJlcXVlc3RlZCB2YWx1ZXMgYW5kIHRoZSB2YWx1ZSBmcm9tIHRoZSB1c2VyJ3MgcHJvZmlsZSBpcyBpbiB0aGUgbGlzdCBvZiB2YWx1ZXMKICoKICogSWYgdGhlIGNsYWltIGlzIGVzc2VudGlhbCBhbmQgbm8gdmFsdWUgaXMgZm91bmQgYW4gSW52YWxpZFJlcXVlc3RFeGNlcHRpb24gd2lsbCBiZSB0aHJvd24gYW5kIHJldHVybmVkIHRvIHRoZSB1c2VyLgogKiBJZiBubyBtYXRjaCBpcyBmb3VuZCBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KZXNzZW50aWFsQ2xhaW1SZXNvbHZlciA9IHsgYXR0cmlidXRlLCBjbGFpbSwgaWRlbnRpdHkgLT4KICAgIHVzZXJQcm9maWxlVmFsdWUgPSBmcm9tU2V0KGNsYWltLmdldE5hbWUoKSwgaWRlbnRpdHkuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkpCiAgICBpZiAoY2xhaW0uaXNFc3NlbnRpYWwoKSAmJiAodXNlclByb2ZpbGVWYWx1ZSA9PSBudWxsIHx8IHVzZXJQcm9maWxlVmFsdWUuaXNFbXB0eSgpKSkgewogICAgICAgIHRocm93IG5ldyBJbnZhbGlkUmVxdWVzdEV4Y2VwdGlvbigiQ291bGQgbm90IHByb3ZpZGUgdmFsdWUgZm9yIGVzc2VudGlhbCBjbGFpbSAkY2xhaW0iKQogICAgfQogICAgaWYgKHVzZXJQcm9maWxlVmFsdWUgIT0gbnVsbCAmJiAoY2xhaW0uZ2V0VmFsdWVzKCkgPT0gbnVsbCB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5pc0VtcHR5KCkgfHwgY2xhaW0uZ2V0VmFsdWVzKCkuY29udGFpbnModXNlclByb2ZpbGVWYWx1ZSkpKSB7CiAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpKTogdXNlclByb2ZpbGVWYWx1ZV0KICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIFs6XQogICAgfQp9CgovKgogKiBDbGFpbSByZXNvbHZlciB3aGljaCBleHBlY3RzIHRoZSB1c2VyJ3MgcHJvZmlsZSBhdHRyaWJ1dGUgdmFsdWUgdG8gYmUgaW4gdGhlIGZvbGxvd2luZyBmb3JtYXQ6CiAqICJsYW5ndWFnZV90YWd8dmFsdWVfZm9yX2xhbmd1YWdlLC4uLiIuCiAqCiAqIFRoaXMgcmVzb2x2ZXIgd2lsbCB0YWtlIHRoZSBsaXN0IG9mIHJlcXVlc3RlZCBsYW5ndWFnZXMgZnJvbSB0aGUgJ2NsYWltc19sb2NhbGVzJyBhdXRob3JpemUgcmVxdWVzdAogKiBwYXJhbWV0ZXIgYW5kIGF0dGVtcHQgdG8gbWF0Y2ggaXQgdG8gYSB2YWx1ZSBmcm9tIHRoZSB1c2VycycgcHJvZmlsZSBhdHRyaWJ1dGUuCiAqIElmIG5vIG1hdGNoIGlzIGZvdW5kIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24uCiAqLwpjbGFpbUxvY2FsZXNDbGFpbVJlc29sdmVyID0geyBhdHRyaWJ1dGUsIGNsYWltLCBpZGVudGl0eSAtPgogICAgdXNlclByb2ZpbGVWYWx1ZSA9IGZyb21TZXQoY2xhaW0uZ2V0TmFtZSgpLCBpZGVudGl0eS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSkKICAgIGlmICh1c2VyUHJvZmlsZVZhbHVlICE9IG51bGwpIHsKICAgICAgICBsb2NhbGVWYWx1ZXMgPSBwYXJzZUxvY2FsZUF3YXJlU3RyaW5nKHVzZXJQcm9maWxlVmFsdWUpCiAgICAgICAgbG9jYWxlID0gY2xhaW1zTG9jYWxlcy5maW5kIHsgbG9jYWxlIC0+IGxvY2FsZVZhbHVlcy5jb250YWluc0tleShsb2NhbGUpIH0KICAgICAgICBpZiAobG9jYWxlICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpKTogbG9jYWxlVmFsdWVzLmdldChsb2NhbGUpXQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBbOl0KfQoKLyoKICogQ2xhaW0gcmVzb2x2ZXIgd2hpY2ggZXhwZWN0cyB0aGUgdXNlcidzIHByb2ZpbGUgYXR0cmlidXRlIHZhbHVlIHRvIGJlIGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgogKiAibGFuZ3VhZ2VfdGFnfHZhbHVlX2Zvcl9sYW5ndWFnZSwuLi4iLgogKgogKiBUaGlzIHJlc29sdmVyIHdpbGwgdGFrZSB0aGUgbGFuZ3VhZ2UgdGFnIHNwZWNpZmllZCBpbiB0aGUgY2xhaW0gb2JqZWN0IGFuZCBhdHRlbXB0IHRvIG1hdGNoIGl0IHRvIGEgdmFsdWUKICogZnJvbSB0aGUgdXNlcnMnIHByb2ZpbGUgYXR0cmlidXRlLiBJZiBubyBtYXRjaCBpcyBmb3VuZCBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KbGFuZ3VhZ2VUYWdDbGFpbVJlc29sdmVyID0geyBhdHRyaWJ1dGUsIGNsYWltLCBpZGVudGl0eSAtPgogICAgdXNlclByb2ZpbGVWYWx1ZSA9IGZyb21TZXQoY2xhaW0uZ2V0TmFtZSgpLCBpZGVudGl0eS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSkKICAgIGlmICh1c2VyUHJvZmlsZVZhbHVlICE9IG51bGwpIHsKICAgICAgICBsb2NhbGVWYWx1ZXMgPSBwYXJzZUxvY2FsZUF3YXJlU3RyaW5nKHVzZXJQcm9maWxlVmFsdWUpCiAgICAgICAgaWYgKGNsYWltLmdldExvY2FsZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGxvY2FsZVZhbHVlcy5jb250YWluc0tleShjbGFpbS5nZXRMb2NhbGUoKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBbKGNsYWltLmdldE5hbWUoKSk6IGxvY2FsZVZhbHVlcy5nZXQoY2xhaW0uZ2V0TG9jYWxlKCkpXQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZW50cnkgPSBsb2NhbGVWYWx1ZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpLm5leHQoKQogICAgICAgICAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpICsgIiMiICsgZW50cnkuZ2V0S2V5KCkpOiBlbnRyeS5nZXRWYWx1ZSgpXQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW50cnkgPSBsb2NhbGVWYWx1ZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpLm5leHQoKQogICAgICAgICAgICByZXR1cm4gWyhjbGFpbS5nZXROYW1lKCkpOiBlbnRyeS5nZXRWYWx1ZSgpXQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBbOl0KfQoKLyoKICogR2l2ZW4gYSBzdHJpbmcgImVufEVuZ2xpc2gsanB8SmFwZW5lc2UsZnJfQ0F8RnJlbmNoIENhbmFkaWFuIiB3aWxsIHJldHVybiBtYXAgb2YgbG9jYWxlIC0+IHZhbHVlLgogKi8KcGFyc2VMb2NhbGVBd2FyZVN0cmluZyA9IHsgcyAtPgogICAgcmV0dXJuIHJlc3VsdCA9IHMuc3BsaXQoIiwiKS5jb2xsZWN0RW50cmllcyB7IGVudHJ5IC0+CiAgICAgICAgc3BsaXQgPSBlbnRyeS5zcGxpdCgiXFx8IikKICAgICAgICBbKHNwbGl0WzBdKTogdmFsdWUgPSBzcGxpdFsxXV0KICAgIH0KfQovLyAtLS1eXl5eXl5eXl5eLS0tIEVYQU1QTEUgQ0xBSU0gQVRUUklCVVRFIFJFU09MVkVSIEZVTkNUSU9OUyAtLS1eXl5eXl5eXl5eLS0tCgovLyAtLS0tLS0tLS0tLS0tLSBVUERBVEUgVEhJUyBUTyBDSEFOR0UgQ0xBSU0gVE8gQVRUUklCVVRFIE1BUFBJTkcgRlVOQ1RJT05TIC0tLS0tLS0tLS0tLS0tLQovKgogKiBMaXN0IG9mIGNsYWltIHJlc29sdmVyIG1hcHBpbmdzLgogKi8KLy8gWyB7Y2xhaW19OiB7YXR0cmlidXRlIHJldHJpZXZlcn0sIC4uLiBdCmNsYWltQXR0cmlidXRlcyA9IFsKICAgICAgICAiZW1haWwiOiB1c2VyUHJvZmlsZUNsYWltUmVzb2x2ZXIuY3VycnkoIm1haWwiKSwKICAgICAgICAiYWRkcmVzcyI6IHsgY2xhaW0sIGlkZW50aXR5IC0+IFsgImZvcm1hdHRlZCIgOiB1c2VyUHJvZmlsZUNsYWltUmVzb2x2ZXIoInBvc3RhbGFkZHJlc3MiLCBjbGFpbSwgaWRlbnRpdHkpIF0gfSwKICAgICAgICAicGhvbmVfbnVtYmVyIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJ0ZWxlcGhvbmVudW1iZXIiKSwKICAgICAgICAiZ2l2ZW5fbmFtZSI6IHVzZXJQcm9maWxlQ2xhaW1SZXNvbHZlci5jdXJyeSgiZ2l2ZW5uYW1lIiksCiAgICAgICAgInpvbmVpbmZvIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJwcmVmZXJyZWR0aW1lem9uZSIpLAogICAgICAgICJmYW1pbHlfbmFtZSI6IHVzZXJQcm9maWxlQ2xhaW1SZXNvbHZlci5jdXJyeSgic24iKSwKICAgICAgICAibG9jYWxlIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJwcmVmZXJyZWRsb2NhbGUiKSwKICAgICAgICAibmFtZSI6IHVzZXJQcm9maWxlQ2xhaW1SZXNvbHZlci5jdXJyeSgiY24iKSwKICAgIAkiZ3JvdXAiOiB1c2VyUHJvZmlsZUNsYWltUmVzb2x2ZXIuY3VycnkoInN1bklkZW50aXR5TVNJU0ROTnVtYmVyIikgCl0KCgovLyAtLS0tLS0tLS0tLS0tLSBVUERBVEUgVEhJUyBUTyBDSEFOR0UgU0NPUEUgVE8gQ0xBSU0gTUFQUElOR1MgLS0tLS0tLS0tLS0tLS0KLyoKICogTWFwIG9mIHNjb3BlcyB0byBjbGFpbSBvYmplY3RzLgogKi8KLy8ge3Njb3BlfTogWyB7Y2xhaW19LCAuLi4gXQpzY29wZUNsYWltc01hcCA9IFsKICAgICAgICAiZ3JvdXAiOiBbICJncm91cCIgXSwKICAgICAgICAiZW1haWwiOiBbICJlbWFpbCIgXSwKICAgICAgICAiYWRkcmVzcyI6IFsgImFkZHJlc3MiIF0sCiAgICAgICAgInBob25lIjogWyAicGhvbmVfbnVtYmVyIiBdLAogICAgICAgICJwcm9maWxlIjogWyAiZ2l2ZW5fbmFtZSIsICJ6b25laW5mbyIsICJmYW1pbHlfbmFtZSIsICJsb2NhbGUiLCAibmFtZSIgXQpdCgoKLy8gLS0tLS0tLS0tLS0tLS0tLSBVUERBVEUgQkVMT1cgRk9SIEFEVkFOQ0VEIFVTQUdFUyAtLS0tLS0tLS0tLS0tLS0tLS0tCmlmIChsb2dnZXIubWVzc2FnZUVuYWJsZWQoKSkgewogICAgc2NvcGVzLmZpbmRBbGwgeyBzIC0+ICEoIm9wZW5pZCIuZXF1YWxzKHMpIHx8IHNjb3BlQ2xhaW1zTWFwLmNvbnRhaW5zS2V5KHMpKSB9LmVhY2ggeyBzIC0+CiAgICAgICAgbG9nZ2VyLm1lc3NhZ2UoIk9wZW5BTVNjb3BlVmFsaWRhdG9yLmdldFVzZXJJbmZvKCk6Ok1lc3NhZ2U6IHNjb3BlIG5vdCBib3VuZCB0byBjbGFpbXM6ICRzIikKICAgIH0KfQoKLyoKICogQ29tcHV0ZXMgdGhlIGNsYWltcyByZXR1cm4ga2V5IGFuZCB2YWx1ZS4gVGhlIGtleSBtYXkgYmUgYSBkaWZmZXJlbnQgdmFsdWUgaWYgdGhlIGNsYWltIHZhbHVlIGlzIG5vdCBpbgogKiB0aGUgcmVxdWVzdGVkIGxhbmd1YWdlLgogKi8KZGVmIGNvbXB1dGVDbGFpbSA9IHsgY2xhaW0gLT4KICAgIHRyeSB7CiAgICAgICAgY2xhaW1SZXNvbHZlciA9IGNsYWltQXR0cmlidXRlcy5nZXQoY2xhaW0uZ2V0TmFtZSgpLCB7IGNsYWltT2JqLCBpZGVudGl0eSAtPiBkZWZhdWx0Q2xhaW1SZXNvbHZlcihjbGFpbSl9KQogICAgICAgIGNsYWltUmVzb2x2ZXIoY2xhaW0sIGlkZW50aXR5KQogICAgfSBjYXRjaCAoSWRSZXBvRXhjZXB0aW9uIGUpIHsKICAgICAgICBpZiAobG9nZ2VyLndhcm5pbmdFbmFibGVkKCkpIHsKICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk9wZW5BTVNjb3BlVmFsaWRhdG9yLmdldFVzZXJJbmZvKCk6IFVuYWJsZSB0byByZXRyaWV2ZSBhdHRyaWJ1dGU9JGF0dHJpYnV0ZSIsIGUpOwogICAgICAgIH0KICAgIH0gY2F0Y2ggKFNTT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOiBVbmFibGUgdG8gcmV0cmlldmUgYXR0cmlidXRlPSRhdHRyaWJ1dGUiLCBlKTsKICAgICAgICB9CiAgICB9Cn0KCi8qCiAqIENvbnZlcnRzIHJlcXVlc3RlZCBzY29wZXMgaW50byBjbGFpbSBvYmplY3RzIGJhc2VkIG9uIHRoZSBzY29wZSBtYXBwaW5ncyBpbiBzY29wZUNsYWltc01hcC4KICovCmRlZiBjb252ZXJ0U2NvcGVUb0NsYWltcyA9IHsKICAgIHNjb3Blcy5maW5kQWxsIHsgc2NvcGUgLT4gIm9wZW5pZCIgIT0gc2NvcGUgJiYgc2NvcGVDbGFpbXNNYXAuY29udGFpbnNLZXkoc2NvcGUpIH0uY29sbGVjdE1hbnkgeyBzY29wZSAtPgogICAgICAgIHNjb3BlQ2xhaW1zTWFwLmdldChzY29wZSkuY29sbGVjdCB7IGNsYWltIC0+CiAgICAgICAgICAgIG5ldyBDbGFpbShjbGFpbSkKICAgICAgICB9CiAgICB9Cn0KCi8vIENyZWF0ZXMgYSBmdWxsIGxpc3Qgb2YgY2xhaW1zIHRvIHJlc29sdmUgZnJvbSByZXF1ZXN0ZWQgc2NvcGVzLCBjbGFpbXMgcHJvdmlkZWQgYnkgQVMgYW5kIHJlcXVlc3RlZCBjbGFpbXMKZGVmIGNsYWltc1RvUmVzb2x2ZSA9IGNvbnZlcnRTY29wZVRvQ2xhaW1zKCkgKyBjbGFpbU9iamVjdHMgKyByZXF1ZXN0ZWRUeXBlZENsYWltcwoKLy8gQ29tcHV0ZXMgdGhlIGNsYWltIHJldHVybiBrZXkgYW5kIHZhbHVlcyBmb3IgYWxsIHJlcXVlc3RlZCBjbGFpbXMKY29tcHV0ZWRDbGFpbXMgPSBjbGFpbXNUb1Jlc29sdmUuY29sbGVjdEVudHJpZXMoKSB7IGNsYWltIC0+CiAgICByZXN1bHQgPSBjb21wdXRlQ2xhaW0oY2xhaW0pCn0KCi8vIENvbXB1dGVzIGNvbXBvc2l0ZSBzY29wZXMKZGVmIGNvbXBvc2l0ZVNjb3BlcyA9IHNjb3BlQ2xhaW1zTWFwLmZpbmRBbGwgeyBzY29wZSAtPgogICAgc2NvcGVzLmNvbnRhaW5zKHNjb3BlLmtleSkKfQoKcmV0dXJuIG5ldyBVc2VySW5mb0NsYWltcygoTWFwKWNvbXB1dGVkQ2xhaW1zLCAoTWFwKWNvbXBvc2l0ZVNjb3Blcyk=",
    "default" : true,
    "language" : "GROOVY",
    "context" : "OIDC_CLAIMS",
    "createdBy" : "null",
    "creationDate" : 0,
    "lastModifiedBy" : "null",
    "lastModifiedDate" : 0
  }
}